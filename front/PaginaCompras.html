<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pavos Fornite</title>
    <!-- Estilos CSS Bootstrap 5 -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <!-- Favicon -->
    <link rel="icon" href="favicon.ico">
    <style>
        /* Estilos personalizados */
        .container {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between; /* Alinear las tarjetas a lo largo de la fila */
        }
        .card {
            width: calc(20% - 20px); /* Calcula el ancho de cada tarjeta para ocupar aproximadamente el 20% del ancho del contenedor */
            margin-bottom: 20px;
            border: 1px solid #ccc;
            border-radius: 5px;
            overflow: hidden;
        }
        .card img {
            width: 100%;
            height: auto;
            border-bottom: 1px solid #ccc;
        }
        .card-info {
            padding: 10px;
        }
        .card-info h2 {
            margin-top: 0;
            margin-bottom: 10px;
        }
        .card-info p {
            margin-top: 0;
        }
    </style>
</head>
<body>
    <main>
        <!-- Header -->
        <header class="d-flex flex-wrap py-3 mb-5 border-bottom">
            <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
                <div class="container">
                    <!-- Agregar el logo y nombre de la marca -->
                    <a class="navbar-brand" href="#">
                        <img src="img/icon.jpg" alt="Logo de J CODES" style="width: 40px; height: 40px;">
                        J CODES
                    </a>
                    <!-- Fin del logo y nombre de la marca -->
                    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <div class="collapse navbar-collapse" id="navbarSupportedContent">
                        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                            <li class="nav-item">
                                <a class="nav-link active" aria-current="page" href="index.html">Home</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" aria-current="page" href="#">Nosotros</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" aria-current="page" href="formulario-contacto.html">Contacto</a>
                            </li>
                        </ul>
                    </div>
                </div>
            </nav>
        </header>
        <br>
        <br>

        <!-- Contenedor principal -->
        <div class="container mb-5">
            <div class="row">
                <!-- Descripción del producto a la izquierda -->
                <div class="col-md-6">
                    <h1>TARJETA DE PAVOS</h1>
                    <h2>¿QUÉ SON LOS PAVOS?</h2>
                    <p><strong>Descripción:</strong> La tarjeta de pavos de Fortnite te permite obtener V-Bucks, la moneda virtual del juego, que puedes utilizar para comprar objetos en la tienda de Fortnite, como skins, bailes, pases de batalla y más.</p>
                    <p>No esperes más y mejora tu experiencia en Fortnite con la tarjeta de pavos.</p>
                    <p><strong>Plataforma para Canjear:</strong> Xbox, PlayStation y PC</p>
                </div>
                
                <!-- Formulario de compra a la derecha -->
                <div class="col-md-6">
                    <h2>Formulario de Compra</h2>
                    <form id="compraForm">
                        <div class="mb-3">
                            <label for="cboCliente" class="form-label">Cliente</label>
                            <select name="cboCliente" id="cboCliente" class="form-control"></select>
                        </div>
                        <div class="mb-3">
                            <label for="productoId" class="form-label">Producto</label>
                            <select name="productoId" id="productoId" class="form-control"></select>
                        </div>
                        <div class="mb-3">
                            <label for="productoPrecio" class="form-label">Precio Unitario</label>
                            <input type="number" class="form-control" id="productoPrecio" readonly>
                        </div>
                        <div class="mb-3">
                            <label for="productoCantidad" class="form-label">Cantidad</label>
                            <input type="number" class="form-control" id="productoCantidad" required>
                        </div>
                        <div class="mb-3">
                            <label for="productoValor" class="form-label">Valor</label>
                            <input type="number" class="form-control" id="productoValor" readonly>
                        </div>
                        <button type="submit" class="btn btn-primary">Comprar</button>
                    </form>    
                    
                    <div id="boletaContainer" style="display:none;">
                        <h3>Boleta</h3>
                        <p><strong>Cliente:</strong> <span id="boletaCliente"></span></p>
                        <p><strong>Email:</strong><span id="boletaEmail"></span></p>
                        <p><strong>Producto:</strong> <span id="boletaProducto"></span></p>
                        <p><strong>Cantidad:</strong> <span id="boletaCantidad"></span></p>
                        <p><strong>Precio Unitario:</strong> <span id="boletaPrecio"></span></p>
                        <p><strong>Total:</strong> <span id="boletaTotal"></span></p>
                    </div>                
                </div>
            </div>
        </div>

        <div class="container">
            <!-- Descripción 1 -->
            <div class="card">
                <img src="img/1000_pavos.jpeg" alt="Tarjeta 1000 V-Bucks">
                <div class="card-info">
                    <h2>Tarjeta 1000 V-Bucks</h2>
                    <p>Esta tarjeta te brinda acceso a un monto de 1000 V-Bucks para utilizar dentro del videojuego Fornite.</p>
                    <p><strong>Precio:</strong> CLP 8,500</p>
                    <p><strong>Plataforma para Canjear:</strong> Xbox, PlayStation y PC</p>
                </div>
            </div>

            <!-- Descripción 2 -->
            <div class="card">
                <img src="img/2800_pavos.jpeg" alt="Tarjeta 2800 V-Bucks">
                <div class="card-info">
                    <h2>Tarjeta 2800 V-Bucks</h2>
                    <p>Esta tarjeta te brinda acceso a un monto de 2800 V-Bucks para utilizar dentro del videojuego Fornite.</p>
                    <p><strong>Precio:</strong> CLP 16,000</p>
                    <p><strong>Plataforma para Canjear:</strong> Xbox, PlayStation y PC</p>
                </div>
            </div>

            <!-- Descripción 3 -->
            <div class="card">
                <img src="img/5000_pavos.jpeg" alt="Tarjeta 5000 V-Bucks">
                <div class="card-info">
                    <h2>Tarjeta 5000 V-Bucks</h2>
                    <p>Esta tarjeta te brinda acceso a un monto de 5000 V-Bucks para utilizar dentro del videojuego Fornite.</p>
                    <p><strong>Precio:</strong> CLP 32,000</p>
                    <p><strong>Plataforma para Canjear:</strong> Xbox, PlayStation y PC</p>
                </div>
            </div>

            <!-- Descripción 4 -->
            <div class="card">
                <img src="img/13500_pavos.jpeg" alt="Tarjeta 13500 V-Bucks">
                <div class="card-info">
                    <h2>Tarjeta 13500 V-Bucks</h2>
                    <p>Esta tarjeta te brinda acceso a un monto de 13500 V-Bucks para utilizar dentro del videojuego Fornite.</p>
                    <p><strong>Precio:</strong> CLP 65,000</p>
                    <p><strong>Plataforma para Canjear:</strong> Xbox, PlayStation y PC</p>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->  
    <footer class="footer mt-auto py-3 bg-light">
        <div class="container">
            <span class="text-muted">J CODES © <script>document.write(new Date().getFullYear())</script></span>
        </div>
    </footer>

    <!-- Archivo JS Bootstrap 5 -->  
    <script src="js/bootstrap.bundle.min.js"></script>
    <script>
        async function cargarClientes() {
            const cboCliente = document.getElementById('cboCliente');
            try {
                const response = await fetch("http://localhost:5000/api/Clientes", { 
                    headers: { "Content-Type": "application/json" },
                    mode: 'cors'
                });
                const listaClientes = await response.json();
                let clienteOptions = '';
                listaClientes.forEach(cliente => {
                    clienteOptions += `<option value="${cliente.id}">${cliente.razonSocial}</option>`;
                });
                cboCliente.innerHTML = clienteOptions;
            } catch (error) {
                console.error('Error fetching clients:', error);
            }
        }
    
        async function cargarProductos() {
            const productoSelect = document.getElementById('productoId');
            try {
                const response = await fetch("http://localhost:5001/api/Productos", { 
                    headers: { "Content-Type": "application/json" },
                    mode: 'cors'
                });
                const productos = await response.json();
                let productoOptions = '';
                productos.forEach(producto => {
                    productoOptions += `<option value="${producto.id}" data-precio="${producto.precio}">${producto.nombreProducto}</option>`;
                });
                productoSelect.innerHTML = productoOptions;
                productoSelect.addEventListener('change', actualizarPrecioUnitario);
            } catch (error) {
                console.error('Error fetching products:', error);
            }
        }
    
        function actualizarPrecioUnitario() {
            const productoSelect = document.getElementById('productoId');
            const precioUnitario = productoSelect.selectedOptions[0].getAttribute('data-precio');
            document.getElementById('productoPrecio').value = precioUnitario;
            actualizarValor();
        }
    
        function actualizarValor() {
            const precioUnitario = parseFloat(document.getElementById('productoPrecio').value);
            const cantidad = parseInt(document.getElementById('productoCantidad').value);
            if (!isNaN(precioUnitario) && !isNaN(cantidad)) {
                document.getElementById('productoValor').value = precioUnitario * cantidad;
            } else {
                document.getElementById('productoValor').value = '';
            }
        }
    
        async function enviarFormulario(event) {
            event.preventDefault();
            const productoId = document.getElementById("productoId").value;
            const cantidadComprada = document.getElementById("productoCantidad").value;
            const costoTotal = document.getElementById("productoValor").value;
    
            const objEnvio = {
                "ProductoId": parseInt(productoId),
                "CantidadComprada": parseInt(cantidadComprada),
                "CostoTotal": parseInt(costoTotal)
            };
    
            console.log('Datos enviados a la API:', objEnvio);
    
            try {
                const responseStock = await fetch("http://localhost:5003/api/StockProducto", {
                headers: { 
                    "Content-Type": "application/json"
                },
                mode: 'cors',
                method: 'POST',
                body: JSON.stringify(objEnvio)
            });

            if (!responseStock.ok) {
                const errorData = await responseStock.json();
                console.error('Error en la respuesta de la API de Stock:', errorData);
                throw new Error('Error al enviar los datos a la API de Stock');
            }

            //const responseBoleta = await fetch("http://localhost:5002/api/Boleta", {
            //    headers: { "Content-Type": "application/json"},
            //    mode: 'cors',
            //    method: 'POST',
            //    body: JSON.stringify(objEnvio)
            //});

            //if (!responseBoleta.ok) {
            //    const errorData = await responseBoleta.json();
            //    console.error('Error en la respuesta de la API de Boleta:', errorData);
            //    throw new Error('Error al enviar los datos a la API de Boleta');
            //}

            //const resultado = await responseBoleta.json();
            //console.log('Respuesta de la API:', resultado);

            //document.getElementById('boletaCliente').innerText = resultado.nombre_cliente;
            //document.getElementById('boletaEmail').innerText = resultado.email_cliente;
            //document.getElementById('boletaProducto').innerText = resultado.id_producto;
            //document.getElementById('boletaCantidad').innerText = resultado.cantidad;
            //document.getElementById('boletaPrecio').innerText = resultado.precio;
            //document.getElementById('boletaTotal').innerText = resultado.total_venta;

            //document.getElementById('boletaContainer').style.display = 'block';

            //alert("Boleta actualizada con éxito");
            } catch (error) {
                console.error('Error enviando el formulario:', error);
                alert("Hubo un error al actualizar el stock; No hay suficientes unidades.");
            }
        }
    
        document.getElementById('compraForm').addEventListener('submit', enviarFormulario);
    
        document.addEventListener('DOMContentLoaded', () => {
            cargarClientes();
            cargarProductos();
            document.getElementById('productoCantidad').addEventListener('input', actualizarValor);
        });
    </script>    
</body>
</html>
